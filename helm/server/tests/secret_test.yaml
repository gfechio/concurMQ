suite: test secret
templates:
  - secret.yaml
tests:
  - it: should render nothing if not enabled
    set:
      global.labels.owner: platform
    asserts:
      - hasDocuments:
          count: 0

  - it: should pass
    set:
      global.labels.owner: platform
      secrets:
        enabled: true
        mountPath: /mnt/beat/secrets/
        items:
          key-test: value-test
          key-token: value-token
    asserts:
      - hasDocuments:
          count: 1
      - isAPIVersion:
          of: v1
      - isKind:
          of: Secret
      - matchRegex:
          path: metadata.name
          pattern: -beat-base$
      - equal:
          path: metadata.labels.owner
          value: platform
      - equal:
          path: data
          value:
            "key-test": |-
              dmFsdWUtdGVzdA==
            "key-token": |-
              dmFsdWUtdG9rZW4=
